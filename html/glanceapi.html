<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using Glance’s Image Public APIs &mdash; Glance 2015.1.1.dev9 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2015.1.1.dev9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Glance 2015.1.1.dev9 documentation" href="index.html" />
    <link rel="next" title="Using Glance’s Client Tools" href="glanceclient.html" />
    <link rel="prev" title="Notifications" href="notifications.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-glance-s-image-public-apis">
<h1>Using Glance&#8217;s Image Public APIs<a class="headerlink" href="#using-glance-s-image-public-apis" title="Permalink to this headline">¶</a></h1>
<p>Glance fully implements versions 1.0, 1.1 and 2.0 of the OpenStack Images API.
The Images API specification is developed alongside Glance, but is not
considered part of the Glance project.</p>
<div class="section" id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p>Glance depends on Keystone and the OpenStack Identity API to handle
authentication of clients. You must obtain an authentication token from
Keystone using and send it along with all API requests to Glance through
the <code class="docutils literal"><span class="pre">X-Auth-Token</span></code> header. Glance will communicate back to Keystone to
verify the token validity and obtain your identity credentials.</p>
<p>See <a class="reference internal" href="authentication.html"><em>Authentication With Keystone</em></a> for more information on integrating with Keystone.</p>
</div>
<div class="section" id="using-v1-x">
<h2>Using v1.X<a class="headerlink" href="#using-v1-x" title="Permalink to this headline">¶</a></h2>
<p>For the purpose of examples, assume there is a Glance API server running
at the URL <code class="docutils literal"><span class="pre">http://glance.example.com</span></code> on the default port 80.</p>
<div class="section" id="list-available-images">
<h3>List Available Images<a class="headerlink" href="#list-available-images" title="Permalink to this headline">¶</a></h3>
<p>We want to see a list of available images that the authenticated user has
access to. This includes images owned by the user, images shared with the user
and public images.</p>
<p>We issue a <code class="docutils literal"><span class="pre">GET</span></code> request to <code class="docutils literal"><span class="pre">http://glance.example.com/v1/images</span></code> to
retrieve this list of available images. The data is returned as a JSON-encoded
mapping in the following format:</p>
<div class="highlight-python"><div class="highlight"><pre>{&#39;images&#39;: [
  {&#39;uri&#39;: &#39;http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9&#39;,
   &#39;name&#39;: &#39;Ubuntu 10.04 Plain&#39;,
   &#39;disk_format&#39;: &#39;vhd&#39;,
   &#39;container_format&#39;: &#39;ovf&#39;,
   &#39;size&#39;: &#39;5368709120&#39;}
  ...]}
</pre></div>
</div>
</div>
<div class="section" id="list-available-images-in-more-detail">
<h3>List Available Images in More Detail<a class="headerlink" href="#list-available-images-in-more-detail" title="Permalink to this headline">¶</a></h3>
<p>We want to see a more detailed list of available images that the authenticated
user has access to. This includes images owned by the user, images shared with
the user and public images.</p>
<p>We issue a <code class="docutils literal"><span class="pre">GET</span></code> request to <code class="docutils literal"><span class="pre">http://glance.example.com/v1/images/detail</span></code> to
retrieve this list of available images. The data is returned as a
JSON-encoded mapping in the following format:</p>
<div class="highlight-python"><div class="highlight"><pre>{&#39;images&#39;: [
  {&#39;uri&#39;: &#39;http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9&#39;,
   &#39;name&#39;: &#39;Ubuntu 10.04 Plain 5GB&#39;,
   &#39;disk_format&#39;: &#39;vhd&#39;,
   &#39;container_format&#39;: &#39;ovf&#39;,
   &#39;size&#39;: &#39;5368709120&#39;,
   &#39;checksum&#39;: &#39;c2e5db72bd7fd153f53ede5da5a06de3&#39;,
   &#39;created_at&#39;: &#39;2010-02-03 09:34:01&#39;,
   &#39;updated_at&#39;: &#39;2010-02-03 09:34:01&#39;,
   &#39;deleted_at&#39;: &#39;&#39;,
   &#39;status&#39;: &#39;active&#39;,
   &#39;is_public&#39;: true,
   &#39;min_ram&#39;: 256,
   &#39;min_disk&#39;: 5,
   &#39;owner&#39;: null,
   &#39;properties&#39;: {&#39;distro&#39;: &#39;Ubuntu 10.04 LTS&#39;}},
  ...]}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>All timestamps returned are in UTC</p>
<p>The <cite>updated_at</cite> timestamp is the timestamp when an image&#8217;s metadata
was last updated, not its image data, as all image data is immutable
once stored in Glance</p>
<p>The <cite>properties</cite> field is a mapping of free-form key/value pairs that
have been saved with the image metadata</p>
<p>The <cite>checksum</cite> field is an MD5 checksum of the image file data</p>
<p>The <cite>is_public</cite> field is a boolean indicating whether the image is
publicly available</p>
<p>The <cite>min_ram</cite> field is an integer specifying the minimum amount of
ram needed to run this image on an instance, in megabytes</p>
<p>The <cite>min_disk</cite> field is an integer specifying the minimum amount of
disk space needed to run this image on an instance, in gigabytes</p>
<p class="last">The <cite>owner</cite> field is a string which may either be null or which will
indicate the owner of the image</p>
</div>
</div>
<div class="section" id="filtering-images-lists">
<h3>Filtering Images Lists<a class="headerlink" href="#filtering-images-lists" title="Permalink to this headline">¶</a></h3>
<p>Both the <code class="docutils literal"><span class="pre">GET</span> <span class="pre">/v1/images</span></code> and <code class="docutils literal"><span class="pre">GET</span> <span class="pre">/v1/images/detail</span></code> requests take query
parameters that serve to filter the returned list of images. The following
list details these query parameters.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">name=NAME</span></code></p>
<p>Filters images having a <code class="docutils literal"><span class="pre">name</span></code> attribute matching <code class="docutils literal"><span class="pre">NAME</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">container_format=FORMAT</span></code></p>
<p>Filters images having a <code class="docutils literal"><span class="pre">container_format</span></code> attribute matching <code class="docutils literal"><span class="pre">FORMAT</span></code></p>
<p>For more information, see <a class="reference internal" href="formats.html"><em>About Disk and Container Formats</em></a></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">disk_format=FORMAT</span></code></p>
<p>Filters images having a <code class="docutils literal"><span class="pre">disk_format</span></code> attribute matching <code class="docutils literal"><span class="pre">FORMAT</span></code></p>
<p>For more information, see <a class="reference internal" href="formats.html"><em>About Disk and Container Formats</em></a></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">status=STATUS</span></code></p>
<p>Filters images having a <code class="docutils literal"><span class="pre">status</span></code> attribute matching <code class="docutils literal"><span class="pre">STATUS</span></code></p>
<p>For more information, see <a class="reference internal" href="statuses.html"><em>About Image Statuses</em></a></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">size_min=BYTES</span></code></p>
<p>Filters images having a <code class="docutils literal"><span class="pre">size</span></code> attribute greater than or equal to <code class="docutils literal"><span class="pre">BYTES</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">size_max=BYTES</span></code></p>
<p>Filters images having a <code class="docutils literal"><span class="pre">size</span></code> attribute less than or equal to <code class="docutils literal"><span class="pre">BYTES</span></code></p>
</li>
</ul>
<p>These two resources also accept additional query parameters:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">sort_key=KEY</span></code></p>
<p>Results will be ordered by the specified image attribute <code class="docutils literal"><span class="pre">KEY</span></code>. Accepted
values include <code class="docutils literal"><span class="pre">id</span></code>, <code class="docutils literal"><span class="pre">name</span></code>, <code class="docutils literal"><span class="pre">status</span></code>, <code class="docutils literal"><span class="pre">disk_format</span></code>,
<code class="docutils literal"><span class="pre">container_format</span></code>, <code class="docutils literal"><span class="pre">size</span></code>, <code class="docutils literal"><span class="pre">created_at</span></code> (default) and <code class="docutils literal"><span class="pre">updated_at</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">sort_dir=DIR</span></code></p>
<p>Results will be sorted in the direction <code class="docutils literal"><span class="pre">DIR</span></code>. Accepted values are <code class="docutils literal"><span class="pre">asc</span></code>
for ascending or <code class="docutils literal"><span class="pre">desc</span></code> (default) for descending.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">marker=ID</span></code></p>
<p>An image identifier marker may be specified. When present only images which
occur after the identifier <code class="docutils literal"><span class="pre">ID</span></code> will be listed, i.e. the images which have
a <cite>sort_key</cite> later than that of the marker <code class="docutils literal"><span class="pre">ID</span></code> in the <cite>sort_dir</cite> direction.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">limit=LIMIT</span></code></p>
<p>When present the maximum number of results returned will not exceed <code class="docutils literal"><span class="pre">LIMIT</span></code>.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the specified <code class="docutils literal"><span class="pre">LIMIT</span></code> exceeds the operator defined limit (api_limit_max)
then the number of results returned may be less than <code class="docutils literal"><span class="pre">LIMIT</span></code>.</p>
</div>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">is_public=PUBLIC</span></code></p>
<p>An admin user may use the <cite>is_public</cite> parameter to control which results are
returned.</p>
<p>When the <cite>is_public</cite> parameter is absent or set to <cite>True</cite> the following images
will be listed: Images whose <cite>is_public</cite> field is <cite>True</cite>, owned images and
shared images.</p>
<p>When the <cite>is_public</cite> parameter is set to <cite>False</cite> the following images will be
listed: Images (owned, shared, or non-owned) whose <cite>is_public</cite> field is <cite>False</cite>.</p>
<p>When the <cite>is_public</cite> parameter is set to <cite>None</cite> all images will be listed
irrespective of owner, shared status or the <cite>is_public</cite> field.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use of the <cite>is_public</cite> parameter is restricted to admin users. For all other
users it will be ignored.</p>
</div>
</div>
<div class="section" id="retrieve-image-metadata">
<h3>Retrieve Image Metadata<a class="headerlink" href="#retrieve-image-metadata" title="Permalink to this headline">¶</a></h3>
<p>We want to see detailed information for a specific virtual machine image
that the Glance server knows about.</p>
<p>We have queried the Glance server for a list of images and the
data returned includes the <cite>uri</cite> field for each available image. This
<cite>uri</cite> field value contains the exact location needed to get the metadata
for a specific image.</p>
<p>Continuing the example from above, in order to get metadata about the
first image returned, we can issue a <code class="docutils literal"><span class="pre">HEAD</span></code> request to the Glance
server for the image&#8217;s URI.</p>
<p>We issue a <code class="docutils literal"><span class="pre">HEAD</span></code> request to
<code class="docutils literal"><span class="pre">http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9</span></code> to
retrieve complete metadata for that image. The metadata is returned as a
set of HTTP headers that begin with the prefix <code class="docutils literal"><span class="pre">x-image-meta-</span></code>. The
following shows an example of the HTTP headers returned from the above
<code class="docutils literal"><span class="pre">HEAD</span></code> request:</p>
<div class="highlight-python"><div class="highlight"><pre>x-image-meta-uri              http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9
x-image-meta-name             Ubuntu 10.04 Plain 5GB
x-image-meta-disk_format      vhd
x-image-meta-container_format ovf
x-image-meta-size             5368709120
x-image-meta-checksum         c2e5db72bd7fd153f53ede5da5a06de3
x-image-meta-created_at       2010-02-03 09:34:01
x-image-meta-updated_at       2010-02-03 09:34:01
x-image-meta-deleted_at
x-image-meta-status           available
x-image-meta-is_public        true
x-image-meta-min_ram          256
x-image-meta-min_disk         0
x-image-meta-owner            null
x-image-meta-property-distro  Ubuntu 10.04 LTS
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>All timestamps returned are in UTC</p>
<p>The <cite>x-image-meta-updated_at</cite> timestamp is the timestamp when an
image&#8217;s metadata was last updated, not its image data, as all
image data is immutable once stored in Glance</p>
<p>There may be multiple headers that begin with the prefix
<cite>x-image-meta-property-</cite>.  These headers are free-form key/value pairs
that have been saved with the image metadata. The key is the string
after <cite>x-image-meta-property-</cite> and the value is the value of the header</p>
<p>The response&#8217;s <cite>ETag</cite> header will always be equal to the
<cite>x-image-meta-checksum</cite> value</p>
<p>The response&#8217;s <cite>x-image-meta-is_public</cite> value is a boolean indicating
whether the image is publicly available</p>
<p class="last">The response&#8217;s <cite>x-image-meta-owner</cite> value is a string which may either
be null or which will indicate the owner of the image</p>
</div>
</div>
<div class="section" id="retrieve-raw-image-data">
<h3>Retrieve Raw Image Data<a class="headerlink" href="#retrieve-raw-image-data" title="Permalink to this headline">¶</a></h3>
<p>We want to retrieve that actual raw data for a specific virtual machine image
that the Glance server knows about.</p>
<p>We have queried the Glance server for a list of images and the
data returned includes the <cite>uri</cite> field for each available image. This
<cite>uri</cite> field value contains the exact location needed to get the metadata
for a specific image.</p>
<p>Continuing the example from above, in order to get metadata about the
first image returned, we can issue a <code class="docutils literal"><span class="pre">HEAD</span></code> request to the Glance
server for the image&#8217;s URI.</p>
<p>We issue a <code class="docutils literal"><span class="pre">GET</span></code> request to
<code class="docutils literal"><span class="pre">http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9</span></code> to
retrieve metadata for that image as well as the image itself encoded
into the response body.</p>
<p>The metadata is returned as a set of HTTP headers that begin with the
prefix <code class="docutils literal"><span class="pre">x-image-meta-</span></code>. The following shows an example of the HTTP headers
returned from the above <code class="docutils literal"><span class="pre">GET</span></code> request:</p>
<div class="highlight-python"><div class="highlight"><pre>x-image-meta-uri              http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9
x-image-meta-name             Ubuntu 10.04 Plain 5GB
x-image-meta-disk_format      vhd
x-image-meta-container_format ovf
x-image-meta-size             5368709120
x-image-meta-checksum         c2e5db72bd7fd153f53ede5da5a06de3
x-image-meta-created_at       2010-02-03 09:34:01
x-image-meta-updated_at       2010-02-03 09:34:01
x-image-meta-deleted_at
x-image-meta-status           available
x-image-meta-is_public        true
x-image-meta-min_ram          256
x-image-meta-min_disk         5
x-image-meta-owner            null
x-image-meta-property-distro  Ubuntu 10.04 LTS
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>All timestamps returned are in UTC</p>
<p>The <cite>x-image-meta-updated_at</cite> timestamp is the timestamp when an
image&#8217;s metadata was last updated, not its image data, as all
image data is immutable once stored in Glance</p>
<p>There may be multiple headers that begin with the prefix
<cite>x-image-meta-property-</cite>.  These headers are free-form key/value pairs
that have been saved with the image metadata. The key is the string
after <cite>x-image-meta-property-</cite> and the value is the value of the header</p>
<p>The response&#8217;s <cite>Content-Length</cite> header shall be equal to the value of
the <cite>x-image-meta-size</cite> header</p>
<p>The response&#8217;s <cite>ETag</cite> header will always be equal to the
<cite>x-image-meta-checksum</cite> value</p>
<p>The response&#8217;s <cite>x-image-meta-is_public</cite> value is a boolean indicating
whether the image is publicly available</p>
<p>The response&#8217;s <cite>x-image-meta-owner</cite> value is a string which may either
be null or which will indicate the owner of the image</p>
<p class="last">The image data itself will be the body of the HTTP response returned
from the request, which will have content-type of
<cite>application/octet-stream</cite>.</p>
</div>
</div>
<div class="section" id="add-a-new-image">
<h3>Add a New Image<a class="headerlink" href="#add-a-new-image" title="Permalink to this headline">¶</a></h3>
<p>We have created a new virtual machine image in some way (created a
&#8220;golden image&#8221; or snapshotted/backed up an existing image) and we
wish to do two things:</p>
<blockquote>
<div><ul class="simple">
<li>Store the disk image data in Glance</li>
<li>Store metadata about this image in Glance</li>
</ul>
</div></blockquote>
<p>We can do the above two activities in a single call to the Glance API.
Assuming, like in the examples above, that a Glance API server is running
at <code class="docutils literal"><span class="pre">glance.example.com</span></code>, we issue a <code class="docutils literal"><span class="pre">POST</span></code> request to add an image to
Glance:</p>
<div class="highlight-python"><div class="highlight"><pre>POST http://glance.example.com/v1/images
</pre></div>
</div>
<p>The metadata about the image is sent to Glance in HTTP headers. The body
of the HTTP request to the Glance API will be the MIME-encoded disk
image data.</p>
</div>
<div class="section" id="reserve-a-new-image">
<h3>Reserve a New Image<a class="headerlink" href="#reserve-a-new-image" title="Permalink to this headline">¶</a></h3>
<p>We can also perform the activities described in <a class="reference internal" href="#add-a-new-image">Add a New Image</a> using two
separate calls to the Image API; the first to register the image metadata, and
the second to add the image disk data.  This is known as &#8220;reserving&#8221; an image.</p>
<p>The first call should be a <code class="docutils literal"><span class="pre">POST</span></code> to <code class="docutils literal"><span class="pre">http://glance.example.com/v1/images</span></code>,
which will result in a new image id being registered with a status of
<code class="docutils literal"><span class="pre">queued</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>{&quot;image&quot;:
 {&quot;status&quot;: &quot;queued&quot;,
  &quot;id&quot;: &quot;71c675ab-d94f-49cd-a114-e12490b328d9&quot;,
  ...}
 ...}
</pre></div>
</div>
<p>The image data can then be added using a <code class="docutils literal"><span class="pre">PUT</span></code> to
<code class="docutils literal"><span class="pre">http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9</span></code>.
The image status will then be set to <code class="docutils literal"><span class="pre">active</span></code> by Glance.</p>
<p><strong>Image Metadata in HTTP Headers</strong></p>
<p>Glance will view as image metadata any HTTP header that it receives in a
<code class="docutils literal"><span class="pre">POST</span></code> request where the header key is prefixed with the strings
<code class="docutils literal"><span class="pre">x-image-meta-</span></code> and <code class="docutils literal"><span class="pre">x-image-meta-property-</span></code>.</p>
<p>The list of metadata headers that Glance accepts are listed below.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-name</span></code></p>
<p>This header is required, unless reserving an image. Its value should be the
name of the image.</p>
<p>Note that the name of an image <em>is not unique to a Glance node</em>. It
would be an unrealistic expectation of users to know all the unique
names of all other user&#8217;s images.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-id</span></code></p>
<p>This header is optional.</p>
<p>When present, Glance will use the supplied identifier for the image.
If the identifier already exists in that Glance node, then a
<strong>409 Conflict</strong> will be returned by Glance. The value of the header
must be an uuid in hexadecimal string notation
(i.e. 71c675ab-d94f-49cd-a114-e12490b328d9).</p>
<p>When this header is <em>not</em> present, Glance will generate an identifier
for the image and return this identifier in the response (see below)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-store</span></code></p>
<p>This header is optional. Valid values are one of <code class="docutils literal"><span class="pre">file</span></code>, <code class="docutils literal"><span class="pre">s3</span></code>, <code class="docutils literal"><span class="pre">rbd</span></code>,
<code class="docutils literal"><span class="pre">swift</span></code>, <code class="docutils literal"><span class="pre">cinder</span></code>, <code class="docutils literal"><span class="pre">gridfs</span></code>, <code class="docutils literal"><span class="pre">sheepdog</span></code> or <code class="docutils literal"><span class="pre">vsphere</span></code></p>
<p>When present, Glance will attempt to store the disk image data in the
backing store indicated by the value of the header. If the Glance node
does not support the backing store, Glance will return a <strong>400 Bad Request</strong>.</p>
<p>When not present, Glance will store the disk image data in the backing
store that is marked default. See the configuration option <code class="docutils literal"><span class="pre">default_store</span></code>
for more information.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-disk_format</span></code></p>
<p>This header is required, unless reserving an image. Valid values are one of
<code class="docutils literal"><span class="pre">aki</span></code>, <code class="docutils literal"><span class="pre">ari</span></code>, <code class="docutils literal"><span class="pre">ami</span></code>, <code class="docutils literal"><span class="pre">raw</span></code>, <code class="docutils literal"><span class="pre">iso</span></code>, <code class="docutils literal"><span class="pre">vhd</span></code>, <code class="docutils literal"><span class="pre">vdi</span></code>, <code class="docutils literal"><span class="pre">qcow2</span></code>, or
<code class="docutils literal"><span class="pre">vmdk</span></code>.</p>
<p>For more information, see <a class="reference internal" href="formats.html"><em>About Disk and Container Formats</em></a></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-container_format</span></code></p>
<p>This header is required, unless reserving an image. Valid values are one of
<code class="docutils literal"><span class="pre">aki</span></code>, <code class="docutils literal"><span class="pre">ari</span></code>, <code class="docutils literal"><span class="pre">ami</span></code>, <code class="docutils literal"><span class="pre">bare</span></code>, or <code class="docutils literal"><span class="pre">ovf</span></code>.</p>
<p>For more information, see <a class="reference internal" href="formats.html"><em>About Disk and Container Formats</em></a></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-size</span></code></p>
<p>This header is optional.</p>
<p>When present, Glance assumes that the expected size of the request body
will be the value of this header. If the length in bytes of the request
body <em>does not match</em> the value of this header, Glance will return a
<strong>400 Bad Request</strong>.</p>
<p>When not present, Glance will calculate the image&#8217;s size based on the size
of the request body.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-checksum</span></code></p>
<p>This header is optional. When present it shall be the expected <strong>MD5</strong>
checksum of the image file data.</p>
<p>When present, Glance will verify the checksum generated from the backend
store when storing your image against this value and return a
<strong>400 Bad Request</strong> if the values do not match.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-is_public</span></code></p>
<p>This header is optional.</p>
<p>When Glance finds the string &#8220;true&#8221; (case-insensitive), the image is marked as
a public image, meaning that any user may view its metadata and may read
the disk image from Glance.</p>
<p>When not present, the image is assumed to be <em>not public</em> and owned by
a user.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-min_ram</span></code></p>
<p>This header is optional. When present it shall be the expected minimum ram
required in megabytes to run this image on a server.</p>
<p>When not present, the image is assumed to have a minimum ram requirement of 0.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-min_disk</span></code></p>
<p>This header is optional. When present it shall be the expected minimum disk
space required in gigabytes to run this image on a server.</p>
<p>When not present, the image is assumed to have a minimum disk space requirement of 0.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-owner</span></code></p>
<p>This header is optional and only meaningful for admins.</p>
<p>Glance normally sets the owner of an image to be the tenant or user
(depending on the &#8220;owner_is_tenant&#8221; configuration option) of the
authenticated user issuing the request.  However, if the authenticated user
has the Admin role, this default may be overridden by setting this header to
null or to a string identifying the owner of the image.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">x-image-meta-property-*</span></code></p>
<p>When Glance receives any HTTP header whose key begins with the string prefix
<code class="docutils literal"><span class="pre">x-image-meta-property-</span></code>, Glance adds the key and value to a set of custom,
free-form image properties stored with the image.  The key is the
lower-cased string following the prefix <code class="docutils literal"><span class="pre">x-image-meta-property-</span></code> with dashes
and punctuation replaced with underscores.</p>
<p>For example, if the following HTTP header were sent:</p>
<div class="highlight-python"><div class="highlight"><pre>x-image-meta-property-distro  Ubuntu 10.10
</pre></div>
</div>
<p>Then a key/value pair of &#8220;distro&#8221;/&#8221;Ubuntu 10.10&#8221; will be stored with the
image in Glance.</p>
<p>There is no limit on the number of free-form key/value attributes that can
be attached to the image.  However, keep in mind that the 8K limit on the
size of all HTTP headers sent in a request will effectively limit the number
of image properties.</p>
</li>
</ul>
</div>
<div class="section" id="update-an-image">
<h3>Update an Image<a class="headerlink" href="#update-an-image" title="Permalink to this headline">¶</a></h3>
<p>Glance will view as image metadata any HTTP header that it receives in a
<code class="docutils literal"><span class="pre">PUT</span></code> request where the header key is prefixed with the strings
<code class="docutils literal"><span class="pre">x-image-meta-</span></code> and <code class="docutils literal"><span class="pre">x-image-meta-property-</span></code>.</p>
<p>If an image was previously reserved, and thus is in the <code class="docutils literal"><span class="pre">queued</span></code> state, then
image data can be added by including it as the request body.  If the image
already as data associated with it (e.g. not in the <code class="docutils literal"><span class="pre">queued</span></code> state), then
including a request body will result in a <strong>409 Conflict</strong> exception.</p>
<p>On success, the <code class="docutils literal"><span class="pre">PUT</span></code> request will return the image metadata encoded as HTTP
headers.</p>
<p>See more about image statuses here: <a class="reference internal" href="statuses.html"><em>Image Statuses</em></a></p>
</div>
<div class="section" id="list-image-memberships">
<h3>List Image Memberships<a class="headerlink" href="#list-image-memberships" title="Permalink to this headline">¶</a></h3>
<p>We want to see a list of the other system tenants (or users, if
&#8220;owner_is_tenant&#8221; is False) that may access a given virtual machine image that
the Glance server knows about.  We take the <cite>uri</cite> field of the image data,
append <code class="docutils literal"><span class="pre">/members</span></code> to it, and issue a <code class="docutils literal"><span class="pre">GET</span></code> request on the resulting URL.</p>
<p>Continuing from the example above, in order to get the memberships for the
first image returned, we can issue a <code class="docutils literal"><span class="pre">GET</span></code> request to the Glance
server for
<code class="docutils literal"><span class="pre">http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members</span></code>
.  What we will get back is JSON data such as the following:</p>
<div class="highlight-python"><div class="highlight"><pre>{&#39;members&#39;: [
 {&#39;member_id&#39;: &#39;tenant1&#39;,
  &#39;can_share&#39;: false}
 ...]}
</pre></div>
</div>
<p>The <cite>member_id</cite> field identifies a tenant with which the image is shared.  If
that tenant is authorized to further share the image, the <cite>can_share</cite> field is
<cite>true</cite>.</p>
</div>
<div class="section" id="list-shared-images">
<h3>List Shared Images<a class="headerlink" href="#list-shared-images" title="Permalink to this headline">¶</a></h3>
<p>We want to see a list of images which are shared with a given tenant.  We issue
a <code class="docutils literal"><span class="pre">GET</span></code> request to <code class="docutils literal"><span class="pre">http://glance.example.com/v1/shared-images/tenant1</span></code>.  We
will get back JSON data such as the following:</p>
<div class="highlight-python"><div class="highlight"><pre>{&#39;shared_images&#39;: [
 {&#39;image_id&#39;: &#39;71c675ab-d94f-49cd-a114-e12490b328d9&#39;,
  &#39;can_share&#39;: false}
 ...]}
</pre></div>
</div>
<p>The <cite>image_id</cite> field identifies an image shared with the tenant named by
<em>member_id</em>.  If the tenant is authorized to further share the image, the
<cite>can_share</cite> field is <cite>true</cite>.</p>
</div>
<div class="section" id="add-a-member-to-an-image">
<h3>Add a Member to an Image<a class="headerlink" href="#add-a-member-to-an-image" title="Permalink to this headline">¶</a></h3>
<p>We want to authorize a tenant to access a private image.  We issue a <code class="docutils literal"><span class="pre">PUT</span></code>
request to
<code class="docutils literal"><span class="pre">http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members/tenant1</span></code>
.  With no body, this will add the membership to the image, leaving existing
memberships unmodified and defaulting new memberships to have <cite>can_share</cite>
set to <cite>false</cite>. We may also optionally attach a body of the following form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;member&#39;</span><span class="p">:</span>
 <span class="p">{</span><span class="s">&#39;can_share&#39;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If such a body is provided, both existing and new memberships will have
<cite>can_share</cite> set to the provided value (either <cite>true</cite> or <cite>false</cite>).  This query
will return a 204 (&#8220;No Content&#8221;) status code.</p>
</div>
<div class="section" id="remove-a-member-from-an-image">
<h3>Remove a Member from an Image<a class="headerlink" href="#remove-a-member-from-an-image" title="Permalink to this headline">¶</a></h3>
<p>We want to revoke a tenant&#8217;s right to access a private image.  We issue a
<code class="docutils literal"><span class="pre">DELETE</span></code> request to <code class="docutils literal"><span class="pre">http://glance.example.com/v1/images/1/members/tenant1</span></code>.
This query will return a 204 (&#8220;No Content&#8221;) status code.</p>
</div>
<div class="section" id="replace-a-membership-list-for-an-image">
<h3>Replace a Membership List for an Image<a class="headerlink" href="#replace-a-membership-list-for-an-image" title="Permalink to this headline">¶</a></h3>
<p>The full membership list for a given image may be replaced.  We issue a <code class="docutils literal"><span class="pre">PUT</span></code>
request to
<code class="docutils literal"><span class="pre">http://glance.example.com/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members</span></code>
with a body of the following form:</p>
<div class="highlight-python"><div class="highlight"><pre>{&#39;memberships&#39;: [
 {&#39;member_id&#39;: &#39;tenant1&#39;,
  &#39;can_share&#39;: false}
 ...]}
</pre></div>
</div>
<p>All existing memberships which are not named in the replacement body are
removed, and those which are named have their <cite>can_share</cite> settings changed as
specified.  (The <cite>can_share</cite> setting may be omitted, which will cause that
setting to remain unchanged in the existing memberships.)  All new memberships
will be created, with <cite>can_share</cite> defaulting to <cite>false</cite> if it is not specified.</p>
</div>
</div>
<div class="section" id="image-membership-changes-in-version-2-0">
<h2>Image Membership Changes in Version 2.0<a class="headerlink" href="#image-membership-changes-in-version-2-0" title="Permalink to this headline">¶</a></h2>
<p>Version 2.0 of the Images API eliminates the <code class="docutils literal"><span class="pre">can_share</span></code> attribute of image
membership.  In the version 2.0 model, image sharing is not transitive.</p>
<p>In version 2.0, image members have a <code class="docutils literal"><span class="pre">status</span></code> attribute that reflects how the
image should be treated with respect to that image member&#8217;s image list.</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">status</span></code> attribute may have one of three values: <code class="docutils literal"><span class="pre">pending</span></code>,
<code class="docutils literal"><span class="pre">accepted</span></code>, or <code class="docutils literal"><span class="pre">rejected</span></code>.</li>
<li>By default, only those shared images with status <code class="docutils literal"><span class="pre">accepted</span></code> are included in
an image member&#8217;s image-list.</li>
<li>Only an image member may change his/her own membership status.</li>
<li>Only an image owner may create members on an image.  The status of a newly
created image member is <code class="docutils literal"><span class="pre">pending</span></code>.  The image owner cannot change the
status of a member.</li>
</ul>
<div class="section" id="distinctions-from-version-1-x-api-calls">
<h3>Distinctions from Version 1.x API Calls<a class="headerlink" href="#distinctions-from-version-1-x-api-calls" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">The response to a request to list the members of an image has changed.</p>
<p>call: <code class="docutils literal"><span class="pre">GET</span></code> on <code class="docutils literal"><span class="pre">/v2/images/{imageId}/members</span></code></p>
<p>response: see the JSON schema at <code class="docutils literal"><span class="pre">/v2/schemas/members</span></code></p>
</li>
<li><p class="first">The request body in the call to create an image member has changed.</p>
<p>call: <code class="docutils literal"><span class="pre">POST</span></code> to <code class="docutils literal"><span class="pre">/v2/images/{imageId}/members</span></code></p>
<p>request body:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&quot;member&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;MEMBER_ID&gt;&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where the {memberId} is the tenant ID of the image member.</p>
<p>The member status of a newly created image member is <code class="docutils literal"><span class="pre">pending</span></code>.</p>
</li>
</ul>
</div>
<div class="section" id="new-api-calls">
<h3>New API Calls<a class="headerlink" href="#new-api-calls" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Change the status of an image member</p>
<p>call: <code class="docutils literal"><span class="pre">PUT</span></code> on  <code class="docutils literal"><span class="pre">/v2/images/{imageId}/members/{memberId}</span></code></p>
<p>request body:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&quot;status&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;STATUS_VALUE&gt;&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where &lt;STATUS_VALUE&gt; is one of <code class="docutils literal"><span class="pre">pending</span></code>, <code class="docutils literal"><span class="pre">accepted</span></code>, or <code class="docutils literal"><span class="pre">rejected</span></code>.
The {memberId} is the tenant ID of the image member.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="api-message-localization">
<h2>API Message Localization<a class="headerlink" href="#api-message-localization" title="Permalink to this headline">¶</a></h2>
<p>Glance supports HTTP message localization. For example, an HTTP client can
receive API messages in Chinese even if the locale language of the server is
English.</p>
<div class="section" id="how-to-use-it">
<h3>How to use it<a class="headerlink" href="#how-to-use-it" title="Permalink to this headline">¶</a></h3>
<p>To receive localized API messages, the HTTP client needs to specify the
<strong>Accept-Language</strong> header to indicate the language to use to translate the
message. For more info about Accept-Language, please refer <a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html</a></p>
<p>A typical curl API request will be like below:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -i -X GET -H &#39;Accept-Language: zh&#39; -H &#39;Content-Type: application/json&#39;
http://127.0.0.1:9292/v2/images/aaa
</pre></div>
</div>
<p>Then the response will be like the following:</p>
<div class="highlight-python"><div class="highlight"><pre>HTTP/1.1 404 Not Found
Content-Length: 234
Content-Type: text/html; charset=UTF-8
X-Openstack-Request-Id: req-54d403a0-064e-4544-8faf-4aeef086f45a
Date: Sat, 22 Feb 2014 06:26:26 GMT

&lt;html&gt;
&lt;head&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;404 Not Found&lt;/h1&gt;
&amp;#25214;&amp;#19981;&amp;#21040;&amp;#20219;&amp;#20309;&amp;#20855;&amp;#26377;&amp;#26631;&amp;#35782; aaa &amp;#30340;&amp;#26144;&amp;#20687;&lt;br /&gt;&lt;br /&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be sure there is the language package under /usr/share/locale-langpack/ on
the target Glance server.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Using Glance&#8217;s Image Public APIs</a><ul>
<li><a class="reference internal" href="#authentication">Authentication</a></li>
<li><a class="reference internal" href="#using-v1-x">Using v1.X</a><ul>
<li><a class="reference internal" href="#list-available-images">List Available Images</a></li>
<li><a class="reference internal" href="#list-available-images-in-more-detail">List Available Images in More Detail</a></li>
<li><a class="reference internal" href="#filtering-images-lists">Filtering Images Lists</a></li>
<li><a class="reference internal" href="#retrieve-image-metadata">Retrieve Image Metadata</a></li>
<li><a class="reference internal" href="#retrieve-raw-image-data">Retrieve Raw Image Data</a></li>
<li><a class="reference internal" href="#add-a-new-image">Add a New Image</a></li>
<li><a class="reference internal" href="#reserve-a-new-image">Reserve a New Image</a></li>
<li><a class="reference internal" href="#update-an-image">Update an Image</a></li>
<li><a class="reference internal" href="#list-image-memberships">List Image Memberships</a></li>
<li><a class="reference internal" href="#list-shared-images">List Shared Images</a></li>
<li><a class="reference internal" href="#add-a-member-to-an-image">Add a Member to an Image</a></li>
<li><a class="reference internal" href="#remove-a-member-from-an-image">Remove a Member from an Image</a></li>
<li><a class="reference internal" href="#replace-a-membership-list-for-an-image">Replace a Membership List for an Image</a></li>
</ul>
</li>
<li><a class="reference internal" href="#image-membership-changes-in-version-2-0">Image Membership Changes in Version 2.0</a><ul>
<li><a class="reference internal" href="#distinctions-from-version-1-x-api-calls">Distinctions from Version 1.x API Calls</a></li>
<li><a class="reference internal" href="#new-api-calls">New API Calls</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-message-localization">API Message Localization</a><ul>
<li><a class="reference internal" href="#how-to-use-it">How to use it</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="notifications.html"
                                  title="previous chapter">Notifications</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="glanceclient.html"
                                  title="next chapter">Using Glance&#8217;s Client Tools</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/glanceapi.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="glanceclient.html" title="Using Glance’s Client Tools"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="notifications.html" title="Notifications"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Glance 2015.1.1.dev9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2010-2014, OpenStack Foundation..
      Last updated on Sat May 2 03:07:23 2015, commit bcc7721.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>